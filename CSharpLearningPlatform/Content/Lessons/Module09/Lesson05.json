{
  "moduleId": 9,
  "lessonNumber": 5,
  "lessonId": "M09L05",
  "title": "Sorting & Aggregating (.OrderBy, .Sum, .Count)",
  "simplifierConcept": "Imagine organizing your bookshelf:\n• SORTING: Arrange books alphabetically by title or author\n• COUNTING: How many books do you have?\n• SUMMING: What's the total value of all books?\n• FINDING: What's the most expensive book? The cheapest?\n\nLINQ has methods for all of these!\n\nSORTING:\n• .OrderBy(x => x) - Ascending (1, 2, 3...)\n• .OrderByDescending(x => x) - Descending (3, 2, 1...)\n• .ThenBy(x => x) - Secondary sort\n\nAGGREGATING (computing single value from collection):\n• .Count() - How many items?\n• .Sum(x => x) - Add them up\n• .Average(x => x) - Mean value\n• .Min(x => x) / .Max(x => x) - Smallest/largest\n\nThink: Sorting organizes. Aggregating calculates. Both are essential for data analysis!",
  "coderExample": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nList<int> numbers = new List<int> { 5, 2, 8, 1, 9, 3, 7 };\n\n// SORTING\nvar ascending = numbers.OrderBy(n => n);\nConsole.WriteLine(\"Ascending: \" + string.Join(\", \", ascending));\n\nvar descending = numbers.OrderByDescending(n => n);\nConsole.WriteLine(\"Descending: \" + string.Join(\", \", descending));\n\n// AGGREGATING\nint count = numbers.Count();\nint sum = numbers.Sum();\ndouble average = numbers.Average();\nint min = numbers.Min();\nint max = numbers.Max();\n\nConsole.WriteLine(\"Count: \" + count);\nConsole.WriteLine(\"Sum: \" + sum);\nConsole.WriteLine(\"Average: \" + average);\nConsole.WriteLine(\"Min: \" + min + \", Max: \" + max);\n\n// WORKING WITH OBJECTS\nclass Product\n{\n    public string Name;\n    public decimal Price;\n    public string Category;\n}\n\nList<Product> products = new List<Product>\n{\n    new Product { Name = \"Laptop\", Price = 999, Category = \"Electronics\" },\n    new Product { Name = \"Mouse\", Price = 25, Category = \"Electronics\" },\n    new Product { Name = \"Desk\", Price = 299, Category = \"Furniture\" },\n    new Product { Name = \"Chair\", Price = 199, Category = \"Furniture\" }\n};\n\n// Sort by price\nvar byPrice = products.OrderBy(p => p.Price);\nforeach (var p in byPrice)\n{\n    Console.WriteLine(p.Name + \": $\" + p.Price);\n}\n\n// Sort by name, then by price (multi-level)\nvar sorted = products\n    .OrderBy(p => p.Category)\n    .ThenBy(p => p.Price);\n\nforeach (var p in sorted)\n{\n    Console.WriteLine(p.Category + \" - \" + p.Name + \": $\" + p.Price);\n}\n\n// Aggregate with selector\nint productCount = products.Count();\ndecimal totalValue = products.Sum(p => p.Price);\ndecimal avgPrice = products.Average(p => p.Price);\ndecimal cheapest = products.Min(p => p.Price);\ndecimal mostExpensive = products.Max(p => p.Price);\n\nConsole.WriteLine(\"Total products: \" + productCount);\nConsole.WriteLine(\"Total value: $\" + totalValue);\nConsole.WriteLine(\"Average price: $\" + avgPrice);\nConsole.WriteLine(\"Price range: $\" + cheapest + \" - $\" + mostExpensive);",
  "syntaxBreakdown": [
    {
      "codeSnippet": ".OrderBy(x => key)",
      "explanation": "Sorts ascending by key. For numbers: .OrderBy(n => n). For objects: .OrderBy(p => p.Price). Returns IEnumerable in sorted order."
    },
    {
      "codeSnippet": ".ThenBy(x => secondKey)",
      "explanation": "Secondary sort after OrderBy. Example: .OrderBy(p => p.Category).ThenBy(p => p.Name) sorts by category first, then name within each category."
    },
    {
      "codeSnippet": ".Count(), .Sum(), .Average()",
      "explanation": "Aggregation methods return single value. .Count() returns int. .Sum() adds values. .Average() calculates mean. These EXECUTE the query immediately!"
    },
    {
      "codeSnippet": ".Min() / .Max()",
      "explanation": "Find smallest/largest. Simple: .Min() on numbers. With selector: .Max(p => p.Price) finds most expensive. Returns single value, not collection."
    }
  ],
  "challenge": {
    "instructions": "Create a student grade analysis system!\n\n1. Create a 'Student' class:\n   - string Name\n   - int Grade (0-100)\n   - string Subject\n\n2. Create a List with 8+ students across 2-3 subjects\n\n3. Perform these operations:\n   - Sort students by grade (descending)\n   - Count how many students there are\n   - Calculate average grade\n   - Find highest and lowest grades\n   - Get sum of all grades\n   - Find students in \"Math\" subject, sorted by name\n   - Calculate average grade for \"Math\" students only\n\n4. Display all results with labels",
    "starterCode": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nclass Student\n{\n    public string Name;\n    public int Grade;\n    public string Subject;\n}\n\nList<Student> students = new List<Student>\n{\n    new Student { Name = \"Alice\", Grade = 85, Subject = \"Math\" },\n    new Student { Name = \"Bob\", Grade = 92, Subject = \"Science\" },\n    // Add 6 more students\n};\n\n// Sort by grade descending\nvar byGrade = students.OrderByDescending(s => /* key */);\n\n// Aggregations\nint totalStudents = students.Count();\ndouble avgGrade = students.Average(s => /* selector */);\nint highest = students.Max(s => /* selector */);\nint lowest = students.Min(s => /* selector */);\nint totalGrades = students.Sum(s => /* selector */);\n\n// Math students sorted by name\nvar mathStudents = students\n    .Where(s => /* filter */)\n    .OrderBy(s => /* key */);\n\n// Math average\ndouble mathAvg = students\n    .Where(s => /* filter */)\n    .Average(s => /* selector */);",
    "solutionCode": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nclass Student\n{\n    public string Name;\n    public int Grade;\n    public string Subject;\n}\n\nList<Student> students = new List<Student>\n{\n    new Student { Name = \"Alice\", Grade = 85, Subject = \"Math\" },\n    new Student { Name = \"Bob\", Grade = 92, Subject = \"Science\" },\n    new Student { Name = \"Charlie\", Grade = 78, Subject = \"Math\" },\n    new Student { Name = \"Diana\", Grade = 95, Subject = \"Science\" },\n    new Student { Name = \"Eve\", Grade = 88, Subject = \"Math\" },\n    new Student { Name = \"Frank\", Grade = 72, Subject = \"English\" },\n    new Student { Name = \"Grace\", Grade = 90, Subject = \"English\" },\n    new Student { Name = \"Henry\", Grade = 83, Subject = \"Math\" }\n};\n\nvar byGrade = students.OrderByDescending(s => s.Grade);\nConsole.WriteLine(\"Students by grade (high to low):\");\nforeach (var s in byGrade)\n{\n    Console.WriteLine(s.Name + \": \" + s.Grade);\n}\n\nint totalStudents = students.Count();\ndouble avgGrade = students.Average(s => s.Grade);\nint highest = students.Max(s => s.Grade);\nint lowest = students.Min(s => s.Grade);\nint totalGrades = students.Sum(s => s.Grade);\n\nConsole.WriteLine(\"\\nStatistics:\");\nConsole.WriteLine(\"Total students: \" + totalStudents);\nConsole.WriteLine(\"Average grade: \" + avgGrade);\nConsole.WriteLine(\"Highest: \" + highest + \", Lowest: \" + lowest);\nConsole.WriteLine(\"Sum of all grades: \" + totalGrades);\n\nvar mathStudents = students\n    .Where(s => s.Subject == \"Math\")\n    .OrderBy(s => s.Name);\n\nConsole.WriteLine(\"\\nMath students (alphabetical):\");\nforeach (var s in mathStudents)\n{\n    Console.WriteLine(s.Name + \": \" + s.Grade);\n}\n\ndouble mathAvg = students\n    .Where(s => s.Subject == \"Math\")\n    .Average(s => s.Grade);\n\nConsole.WriteLine(\"\\nMath average: \" + mathAvg);",
    "hint": "OrderBy: '.OrderBy(x => x.Property)'. Aggregates: '.Count()', '.Sum(x => x.Prop)', '.Average(x => x.Prop)', '.Min()/.Max()'. Chain with .Where() for filtered aggregates!",
    "expectedOutputPatterns": ["Total students", "Average grade", "Highest", "Math average"],
    "validationRules": [],
    "commonStickingPoints": [
      "Forgetting selector in aggregate: '.Sum()' on objects doesn't work! Must specify what to sum: '.Sum(p => p.Price)'. Only works without selector on collections of numbers.",
      "OrderBy doesn't modify original: Like all LINQ, .OrderBy() returns NEW sequence! Original list is unchanged. Assign result: 'var sorted = list.OrderBy(...)'.",
      "Using .Count property vs .Count() method: IEnumerable has .Count() METHOD. List has .Count PROPERTY. Both work, but property is faster on List!",
      "Average on empty collection: '.Average()' on empty collection throws exception! Check '.Any()' first, or use default: 'list.Any() ? list.Average() : 0'."
    ]
  }
}
