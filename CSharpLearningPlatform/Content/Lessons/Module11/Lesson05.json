{
  "moduleId": 11,
  "lessonNumber": 5,
  "lessonId": "M11L05",
  "title": "Returning Data & Status Codes (Speaking HTTP)",
  "simplifierConcept": "Imagine calling a restaurant:\n\nYou: \"Do you have a table for 4?\"\n\nGOOD responses:\n✅ \"Yes, table 12 is ready!\" (200 OK with data)\n✅ \"Sorry, we're fully booked\" (404 Not Found)\n✅ \"Invalid number, we don't have table for -1 people!\" (400 Bad Request)\n\nBAD response:\n❌ \"Umm... maybe? I dunno\" (Unclear status)\n\nHTTP STATUS CODES are how APIs communicate results:\n\n2xx SUCCESS:\n• 200 OK - Request succeeded, here's data\n• 201 Created - New resource created\n• 204 No Content - Success, but no data to return\n\n4xx CLIENT ERROR (user's fault):\n• 400 Bad Request - Invalid input\n• 404 Not Found - Resource doesn't exist\n• 401 Unauthorized - Need to log in\n\n5xx SERVER ERROR (our fault):\n• 500 Internal Server Error - Something broke\n\nThink: Status codes = 'The universal language of HTTP. Speak it correctly!'",
  "coderExample": "using Microsoft.AspNetCore.Builder;\nusing System.Collections.Generic;\nusing System.Linq;\n\nvar builder = WebApplication.CreateBuilder(args);\nvar app = builder.Build();\n\nclass User\n{\n    public int Id { get; set; }\n    public string? Name { get; set; }\n    public string? Email { get; set; }\n    public int Age { get; set; }\n}\n\nvar users = new List<User>\n{\n    new User { Id = 1, Name = \"Alice\", Email = \"alice@example.com\", Age = 30 }\n};\n\nint nextId = 2;\n\n// 200 OK - Standard success\napp.MapGet(\"/api/users\", () => \n{\n    return Results.Ok(users);  // Explicit 200\n    // OR just: return users;  // Implicit 200\n});\n\n// 200 OK or 404 Not Found\napp.MapGet(\"/api/users/{id}\", (int id) =>\n{\n    var user = users.FirstOrDefault(u => u.Id == id);\n    return user is not null \n        ? Results.Ok(user)        // 200 with data\n        : Results.NotFound();     // 404\n});\n\n// 201 Created - New resource\napp.MapPost(\"/api/users\", (User user) =>\n{\n    // Validation\n    if (string.IsNullOrEmpty(user.Name))\n        return Results.BadRequest(\"Name is required!\");  // 400\n    \n    if (user.Age < 0 || user.Age > 120)\n        return Results.BadRequest(\"Invalid age!\");  // 400\n    \n    user.Id = nextId++;\n    users.Add(user);\n    \n    // 201 with location header and created object\n    return Results.Created($\"/api/users/{user.Id}\", user);\n});\n\n// 200 OK or 404 Not Found\napp.MapPut(\"/api/users/{id}\", (int id, User updatedUser) =>\n{\n    var user = users.FirstOrDefault(u => u.Id == id);\n    if (user is null) return Results.NotFound();  // 404\n    \n    // Validation\n    if (updatedUser.Age < 0)\n        return Results.BadRequest(\"Age cannot be negative!\");  // 400\n    \n    user.Name = updatedUser.Name;\n    user.Email = updatedUser.Email;\n    user.Age = updatedUser.Age;\n    \n    return Results.Ok(user);  // 200 with updated data\n});\n\n// 204 No Content or 404 Not Found\napp.MapDelete(\"/api/users/{id}\", (int id) =>\n{\n    var user = users.FirstOrDefault(u => u.Id == id);\n    if (user is null) return Results.NotFound();  // 404\n    \n    users.Remove(user);\n    return Results.NoContent();  // 204 - success, no data\n});\n\n// Custom status code\napp.MapGet(\"/api/admin\", () =>\n{\n    return Results.StatusCode(403);  // 403 Forbidden\n});\n\napp.Run();",
  "syntaxBreakdown": [
    {
      "codeSnippet": "Results.Ok(value)",
      "explanation": "Returns 200 OK with data. Most common success response. Can also just 'return value' for implicit 200."
    },
    {
      "codeSnippet": "Results.Created(uri, value)",
      "explanation": "Returns 201 Created. First param is URL of new resource. Used for POST. Tells client where to find the new item!"
    },
    {
      "codeSnippet": "Results.BadRequest(message)",
      "explanation": "Returns 400 Bad Request. Use when client sends invalid data. Include helpful error message!"
    },
    {
      "codeSnippet": "Results.NotFound()",
      "explanation": "Returns 404 Not Found. Resource doesn't exist. Don't return null - use proper 404!"
    },
    {
      "codeSnippet": "Results.NoContent()",
      "explanation": "Returns 204 No Content. Success but no data to return. Common for DELETE operations."
    },
    {
      "codeSnippet": "Results.StatusCode(code)",
      "explanation": "Returns custom status code. For less common codes: 403 Forbidden, 409 Conflict, 422 Unprocessable Entity, etc."
    }
  ],
  "challenge": {
    "instructions": "Build a Product API with proper status codes and validation!\n\n1. Create 'Product' class (Id, Name, Price, Stock)\n\n2. Create endpoints with PROPER status codes:\n\n   GET /api/products -> 200 OK with all products\n   \n   GET /api/products/{id} -> 200 OK if found, 404 if not\n   \n   POST /api/products -> Validate:\n     - Name required (400 if missing)\n     - Price must be > 0 (400 if not)\n     - Stock must be >= 0 (400 if negative)\n     - If valid: 201 Created with location\n   \n   PUT /api/products/{id} -> Validate same as POST:\n     - 404 if product not found\n     - 400 if validation fails\n     - 200 OK with updated product if success\n   \n   DELETE /api/products/{id} -> 404 if not found, 204 if deleted\n\n3. Return helpful error messages for 400 responses!",
    "starterCode": "using Microsoft.AspNetCore.Builder;\nusing System.Collections.Generic;\nusing System.Linq;\n\nvar builder = WebApplication.CreateBuilder(args);\nvar app = builder.Build();\n\nclass Product\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public decimal Price { get; set; }\n    public int Stock { get; set; }\n}\n\nvar products = new List<Product>\n{\n    new Product { Id = 1, Name = \"Laptop\", Price = 999.99m, Stock = 10 }\n};\nint nextId = 2;\n\napp.MapGet(\"/api/products\", () => Results.Ok(products));\n\napp.MapGet(\"/api/products/{id}\", (int id) =>\n{\n    // Find and return 200 or 404\n});\n\napp.MapPost(\"/api/products\", (Product product) =>\n{\n    // Validate Name\n    // Validate Price\n    // Validate Stock\n    // If valid, add and return 201\n});\n\napp.MapPut(\"/api/products/{id}\", (int id, Product updated) =>\n{\n    // Find product (404 if not found)\n    // Validate input (400 if invalid)\n    // Update and return 200\n});\n\napp.MapDelete(\"/api/products/{id}\", (int id) =>\n{\n    // Find and delete, return 204 or 404\n});\n\nConsole.WriteLine(\"Product API with proper status codes!\");",
    "solutionCode": "using Microsoft.AspNetCore.Builder;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nvar builder = WebApplication.CreateBuilder(args);\nvar app = builder.Build();\n\nclass Product\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public decimal Price { get; set; }\n    public int Stock { get; set; }\n}\n\nvar products = new List<Product>\n{\n    new Product { Id = 1, Name = \"Laptop\", Price = 999.99m, Stock = 10 }\n};\nint nextId = 2;\n\napp.MapGet(\"/api/products\", () => Results.Ok(products));\n\napp.MapGet(\"/api/products/{id}\", (int id) =>\n{\n    var product = products.FirstOrDefault(p => p.Id == id);\n    return product is not null ? Results.Ok(product) : Results.NotFound();\n});\n\napp.MapPost(\"/api/products\", (Product product) =>\n{\n    if (string.IsNullOrEmpty(product.Name))\n        return Results.BadRequest(\"Product name is required!\");\n    \n    if (product.Price <= 0)\n        return Results.BadRequest(\"Price must be greater than 0!\");\n    \n    if (product.Stock < 0)\n        return Results.BadRequest(\"Stock cannot be negative!\");\n    \n    product.Id = nextId++;\n    products.Add(product);\n    return Results.Created($\"/api/products/{product.Id}\", product);\n});\n\napp.MapPut(\"/api/products/{id}\", (int id, Product updated) =>\n{\n    var product = products.FirstOrDefault(p => p.Id == id);\n    if (product is null) return Results.NotFound();\n    \n    if (string.IsNullOrEmpty(updated.Name))\n        return Results.BadRequest(\"Product name is required!\");\n    \n    if (updated.Price <= 0)\n        return Results.BadRequest(\"Price must be greater than 0!\");\n    \n    if (updated.Stock < 0)\n        return Results.BadRequest(\"Stock cannot be negative!\");\n    \n    product.Name = updated.Name;\n    product.Price = updated.Price;\n    product.Stock = updated.Stock;\n    \n    return Results.Ok(product);\n});\n\napp.MapDelete(\"/api/products/{id}\", (int id) =>\n{\n    var product = products.FirstOrDefault(p => p.Id == id);\n    if (product is null) return Results.NotFound();\n    \n    products.Remove(product);\n    return Results.NoContent();\n});\n\nConsole.WriteLine(\"Product API with proper status codes!\");\nConsole.WriteLine(\"Returns: 200 OK, 201 Created, 204 No Content, 400 Bad Request, 404 Not Found\");",
    "hint": "Validation: check conditions, return Results.BadRequest(\"message\") if invalid. Not found: Results.NotFound(). Success: Results.Ok(data) or Results.Created(uri, data) or Results.NoContent().",
    "expectedOutputPatterns": ["Product API", "status codes", "200", "201", "400", "404"],
    "validationRules": [],
    "commonStickingPoints": [
      "Returning wrong status for errors: Don't return 200 OK for errors! Validation failure = 400 Bad Request. Resource not found = 404. Use correct codes!",
      "Not including error messages: Results.BadRequest() with no message is unhelpful! Always include message: Results.BadRequest(\\\"Name is required!\\\"). Help the client fix the issue!",
      "Using 200 for POST: POST should return 201 Created, not 200! Use Results.Created() with location URI. It's the HTTP standard for resource creation.",
      "Returning null instead of 404: Don't 'return null' - it gives 204 No Content! Use 'Results.NotFound()' for proper 404 status. Status codes communicate meaning!"
    ]
  }
}
