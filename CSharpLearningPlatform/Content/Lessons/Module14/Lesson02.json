{
  "moduleId": 14,
  "lessonNumber": 2,
  "lessonId": "M14L02",
  "title": "Full CRUD Operations (Complete Data Management)",
  "simplifierConcept": "CRUD = Create, Read, Update, Delete - The four essential database operations:\n\nRestaurant analogy:\n‚Ä¢ CREATE: Add new dish to menu\n‚Ä¢ READ: View menu\n‚Ä¢ UPDATE: Change dish price\n‚Ä¢ DELETE: Remove dish from menu\n\nFull-stack CRUD:\nBlazor UI ‚Üí HTTP ‚Üí API ‚Üí EF Core ‚Üí Database\n\n‚úÖ CREATE: Form ‚Üí POST ‚Üí API ‚Üí db.Add() ‚Üí SaveChanges()\n‚úÖ READ: Load ‚Üí GET ‚Üí API ‚Üí db.ToList() ‚Üí Display\n‚úÖ UPDATE: Edit ‚Üí PUT ‚Üí API ‚Üí db.Update() ‚Üí SaveChanges()\n‚úÖ DELETE: Button ‚Üí DELETE ‚Üí API ‚Üí db.Remove() ‚Üí SaveChanges()\n\nThink: CRUD = 'The foundation of every data-driven application!'",
  "coderExample": "// FULL CRUD API\napp.MapGet(\"/api/products\", async (AppDbContext db) =>\n    await db.Products.ToListAsync());\n\napp.MapGet(\"/api/products/{id}\", async (int id, AppDbContext db) =>\n    await db.Products.FindAsync(id));\n\napp.MapPost(\"/api/products\", async (Product product, AppDbContext db) => {\n    db.Products.Add(product);\n    await db.SaveChangesAsync();\n    return Results.Created($\"/api/products/{product.Id}\", product);\n});\n\napp.MapPut(\"/api/products/{id}\", async (int id, Product updated, AppDbContext db) => {\n    var product = await db.Products.FindAsync(id);\n    if (product is null) return Results.NotFound();\n    \n    product.Name = updated.Name;\n    product.Price = updated.Price;\n    await db.SaveChangesAsync();\n    return Results.Ok(product);\n});\n\napp.MapDelete(\"/api/products/{id}\", async (int id, AppDbContext db) => {\n    var product = await db.Products.FindAsync(id);\n    if (product is null) return Results.NotFound();\n    \n    db.Products.Remove(product);\n    await db.SaveChangesAsync();\n    return Results.NoContent();\n});\n\n// BLAZOR CRUD COMPONENT\n@inject HttpClient Http\n\n<h3>Product Manager</h3>\n\n<button @onclick=\"ShowCreateForm\">Add Product</button>\n\n@if (showForm)\n{\n    <EditForm Model=\"@currentProduct\" OnValidSubmit=\"SaveProduct\">\n        <InputText @bind-Value=\"currentProduct.Name\" />\n        <InputNumber @bind-Value=\"currentProduct.Price\" />\n        <button type=\"submit\">Save</button>\n        <button type=\"button\" @onclick=\"CancelForm\">Cancel</button>\n    </EditForm>\n}\n\n<table>\n    @foreach (var product in products)\n    {\n        <tr>\n            <td>@product.Name</td>\n            <td>$@product.Price</td>\n            <td>\n                <button @onclick=\"() => EditProduct(product)\">Edit</button>\n                <button @onclick=\"() => DeleteProduct(product.Id)\">Delete</button>\n            </td>\n        </tr>\n    }\n</table>\n\n@code {\n    private List<Product> products = new();\n    private Product currentProduct = new();\n    private bool showForm = false;\n    private bool isEditing = false;\n    \n    protected override async Task OnInitializedAsync() {\n        await LoadProducts();\n    }\n    \n    private async Task LoadProducts() {\n        products = await Http.GetFromJsonAsync<List<Product>>(\n            \"https://localhost:5001/api/products\") ?? new();\n    }\n    \n    private void ShowCreateForm() {\n        currentProduct = new Product();\n        isEditing = false;\n        showForm = true;\n    }\n    \n    private void EditProduct(Product product) {\n        currentProduct = new Product {\n            Id = product.Id,\n            Name = product.Name,\n            Price = product.Price\n        };\n        isEditing = true;\n        showForm = true;\n    }\n    \n    private async Task SaveProduct() {\n        if (isEditing) {\n            await Http.PutAsJsonAsync(\n                $\"https://localhost:5001/api/products/{currentProduct.Id}\", \n                currentProduct);\n        } else {\n            await Http.PostAsJsonAsync(\n                \"https://localhost:5001/api/products\", \n                currentProduct);\n        }\n        \n        showForm = false;\n        await LoadProducts();\n    }\n    \n    private async Task DeleteProduct(int id) {\n        await Http.DeleteAsync($\"https://localhost:5001/api/products/{id}\");\n        await LoadProducts();\n    }\n    \n    private void CancelForm() {\n        showForm = false;\n    }\n}",
  "syntaxBreakdown": [
    {
      "codeSnippet": "EditForm component",
      "explanation": "Blazor form with validation. Model=\"@object\" binds form. OnValidSubmit fires when valid. InputText, InputNumber are built-in inputs with validation."
    },
    {
      "codeSnippet": "Create vs Update pattern",
      "explanation": "Use boolean flag (isEditing). If true: PUT existing. If false: POST new. Same form, different API call based on context."
    },
    {
      "codeSnippet": "SaveChangesAsync()",
      "explanation": "EF Core persists changes to database. Call after Add/Update/Remove. Returns number of affected rows. Always await!"
    },
    {
      "codeSnippet": "Reload after changes",
      "explanation": "After Create/Update/Delete, reload data from API. Ensures UI shows latest database state. Call LoadProducts() after operations."
    }
  ],
  "challenge": {
    "instructions": "Build complete CRUD for a Book Library!\n\n1. Book model (Id, Title, Author, Year, ISBN)\n\n2. API with all CRUD endpoints:\n   - GET /api/books (list all)\n   - GET /api/books/{id} (single)\n   - POST /api/books (create)\n   - PUT /api/books/{id} (update)\n   - DELETE /api/books/{id} (delete)\n\n3. Blazor component:\n   - List books in table\n   - Add button ‚Üí shows form\n   - Edit button for each book ‚Üí populates form\n   - Delete button with confirmation\n   - Form with all fields\n   - Save/Cancel buttons\n   - Reload after operations\n\n4. Print complete API and Blazor code!",
    "starterCode": "// API\napp.MapGet(\"/api/books\", async (AppDbContext db) => {\n    // Return all books\n});\n\n// Add other CRUD endpoints...\n\n// Blazor - BookManager.razor\n@inject HttpClient Http\n\n<h3>Book Library</h3>\n\n@if (showForm)\n{\n    <EditForm Model=\"@currentBook\" OnValidSubmit=\"SaveBook\">\n        <!-- Form fields -->\n    </EditForm>\n}\n\n<!-- Table of books -->\n\n@code {\n    private List<Book> books = new();\n    private Book currentBook = new();\n    private bool showForm = false;\n    private bool isEditing = false;\n}",
    "solutionCode": "Console.WriteLine(@\"\n=== FULL CRUD API ===\");\nConsole.WriteLine(@\"\nusing Microsoft.EntityFrameworkCore;\n\nvar builder = WebApplication.CreateBuilder(args);\nbuilder.Services.AddDbContext<AppDbContext>();\nvar app = builder.Build();\n\nclass Book {\n    public int Id { get; set; }\n    public string Title { get; set; } = \"\"\"\";\n    public string Author { get; set; } = \"\"\"\";\n    public int Year { get; set; }\n    public string ISBN { get; set; } = \"\"\"\";\n}\n\n// CREATE\napp.MapPost(\"\"/api/books\"\", async (Book book, AppDbContext db) => {\n    db.Books.Add(book);\n    await db.SaveChangesAsync();\n    return Results.Created($\"\"/api/books/{book.Id}\"\", book);\n});\n\n// READ - All\napp.MapGet(\"\"/api/books\"\", async (AppDbContext db) =>\n    await db.Books.ToListAsync());\n\n// READ - Single\napp.MapGet(\"\"/api/books/{id}\"\", async (int id, AppDbContext db) => {\n    var book = await db.Books.FindAsync(id);\n    return book is not null ? Results.Ok(book) : Results.NotFound();\n});\n\n// UPDATE\napp.MapPut(\"\"/api/books/{id}\"\", async (int id, Book updated, AppDbContext db) => {\n    var book = await db.Books.FindAsync(id);\n    if (book is null) return Results.NotFound();\n    \n    book.Title = updated.Title;\n    book.Author = updated.Author;\n    book.Year = updated.Year;\n    book.ISBN = updated.ISBN;\n    \n    await db.SaveChangesAsync();\n    return Results.Ok(book);\n});\n\n// DELETE\napp.MapDelete(\"\"/api/books/{id}\"\", async (int id, AppDbContext db) => {\n    var book = await db.Books.FindAsync(id);\n    if (book is null) return Results.NotFound();\n    \n    db.Books.Remove(book);\n    await db.SaveChangesAsync();\n    return Results.NoContent();\n});\n\napp.Run();\n\"\");\n\nConsole.WriteLine(@\"\n=== BLAZOR CRUD COMPONENT ===\");\nConsole.WriteLine(@\"\n// BookManager.razor\n@inject HttpClient Http\n\n<div class=\"\"container\"\">\n    <h3>üìö Book Library Manager</h3>\n    \n    <button class=\"\"btn btn-primary\"\" @onclick=\"\"ShowCreateForm\"\">‚ûï Add New Book</button>\n    \n    @if (showForm)\n    {\n        <div class=\"\"card mt-3\"\">\n            <div class=\"\"card-body\"\">\n                <h5>@(isEditing ? \"\"Edit Book\"\" : \"\"Add New Book\"\")</h5>\n                <EditForm Model=\"\"@currentBook\"\" OnValidSubmit=\"\"SaveBook\"\">\n                    <div class=\"\"mb-2\"\">\n                        <label>Title:</label>\n                        <InputText @bind-Value=\"\"currentBook.Title\"\" class=\"\"form-control\"\" />\n                    </div>\n                    <div class=\"\"mb-2\"\">\n                        <label>Author:</label>\n                        <InputText @bind-Value=\"\"currentBook.Author\"\" class=\"\"form-control\"\" />\n                    </div>\n                    <div class=\"\"mb-2\"\">\n                        <label>Year:</label>\n                        <InputNumber @bind-Value=\"\"currentBook.Year\"\" class=\"\"form-control\"\" />\n                    </div>\n                    <div class=\"\"mb-2\"\">\n                        <label>ISBN:</label>\n                        <InputText @bind-Value=\"\"currentBook.ISBN\"\" class=\"\"form-control\"\" />\n                    </div>\n                    <button type=\"\"submit\"\" class=\"\"btn btn-success\"\">üíæ Save</button>\n                    <button type=\"\"button\"\" class=\"\"btn btn-secondary\"\" @onclick=\"\"CancelForm\"\">Cancel</button>\n                </EditForm>\n            </div>\n        </div>\n    }\n    \n    <table class=\"\"table table-striped mt-3\"\">\n        <thead>\n            <tr>\n                <th>Title</th>\n                <th>Author</th>\n                <th>Year</th>\n                <th>ISBN</th>\n                <th>Actions</th>\n            </tr>\n        </thead>\n        <tbody>\n            @foreach (var book in books)\n            {\n                <tr>\n                    <td>@book.Title</td>\n                    <td>@book.Author</td>\n                    <td>@book.Year</td>\n                    <td>@book.ISBN</td>\n                    <td>\n                        <button class=\"\"btn btn-sm btn-warning\"\" @onclick=\"\"() => EditBook(book)\"\">‚úèÔ∏è Edit</button>\n                        <button class=\"\"btn btn-sm btn-danger\"\" @onclick=\"\"() => DeleteBook(book.Id)\"\">üóëÔ∏è Delete</button>\n                    </td>\n                </tr>\n            }\n        </tbody>\n    </table>\n    \n    <p><strong>Total Books: @books.Count</strong></p>\n</div>\n\n@code {\n    private class Book {\n        public int Id { get; set; }\n        public string Title { get; set; } = \"\"\"\";\n        public string Author { get; set; } = \"\"\"\";\n        public int Year { get; set; }\n        public string ISBN { get; set; } = \"\"\"\";\n    }\n    \n    private List<Book> books = new();\n    private Book currentBook = new();\n    private bool showForm = false;\n    private bool isEditing = false;\n    \n    protected override async Task OnInitializedAsync() {\n        await LoadBooks();\n    }\n    \n    private async Task LoadBooks() {\n        books = await Http.GetFromJsonAsync<List<Book>>(\"\"https://localhost:5001/api/books\"\") ?? new();\n    }\n    \n    private void ShowCreateForm() {\n        currentBook = new Book();\n        isEditing = false;\n        showForm = true;\n    }\n    \n    private void EditBook(Book book) {\n        currentBook = new Book {\n            Id = book.Id,\n            Title = book.Title,\n            Author = book.Author,\n            Year = book.Year,\n            ISBN = book.ISBN\n        };\n        isEditing = true;\n        showForm = true;\n    }\n    \n    private async Task SaveBook() {\n        if (isEditing) {\n            await Http.PutAsJsonAsync($\"\"https://localhost:5001/api/books/{currentBook.Id}\"\", currentBook);\n        } else {\n            await Http.PostAsJsonAsync(\"\"https://localhost:5001/api/books\"\", currentBook);\n        }\n        \n        showForm = false;\n        await LoadBooks();\n    }\n    \n    private async Task DeleteBook(int id) {\n        if (confirm(\\\"\"Delete this book?\\\"\")) {\n            await Http.DeleteAsync($\"\"https://localhost:5001/api/books/{id}\"\");\n            await LoadBooks();\n        }\n    }\n    \n    private void CancelForm() {\n        showForm = false;\n    }\n}\n\"\");\n\nConsole.WriteLine(@\"\n=== CRUD COMPLETE! ===\");\nConsole.WriteLine(\"‚úì CREATE: POST with form data\");\nConsole.WriteLine(\"‚úì READ: GET for list and details\");\nConsole.WriteLine(\"‚úì UPDATE: PUT with modified data\");\nConsole.WriteLine(\"‚úì DELETE: DELETE by ID\");\nConsole.WriteLine(\"\\nYou've built a complete data management system!\");",
    "hint": "API: MapPost (Create), MapGet (Read), MapPut (Update), MapDelete (Delete). Blazor: EditForm for input, HttpClient for requests, reload after changes. Track isEditing for Create vs Update.",
    "expectedOutputPatterns": ["CRUD", "CREATE", "READ", "UPDATE", "DELETE", "EditForm"],
    "validationRules": [],
    "commonStickingPoints": [
      "Modifying original object: When editing, create NEW object copy! Otherwise, changes appear immediately in UI before save. Clone object: 'new Book { Id = book.Id, ... }'.",
      "Not reloading data: After Create/Update/Delete, UI shows stale data! Always reload: 'await LoadBooks();' after operations. Otherwise, database and UI out of sync.",
      "Missing confirmation: DELETE without confirmation is dangerous! Users accidentally click. Add: 'if (confirm(\"Delete?\"))' or modal dialog before delete.",
      "Form validation: EditForm needs validation! Add DataAnnotations: [Required], [StringLength], etc. Or use OnInvalidSubmit to handle errors. Validate before API call!"
    ]
  }
}
