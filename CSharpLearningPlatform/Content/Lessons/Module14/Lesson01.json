{
  "moduleId": 14,
  "lessonNumber": 1,
  "lessonId": "M14L01",
  "title": "Connecting Blazor to API (Frontend + Backend)",
  "simplifierConcept": "Full Stack = Frontend + Backend working together:\n\nFRONTEND (Blazor):\n‚Ä¢ The restaurant customer\n‚Ä¢ Sees menu, orders food\n‚Ä¢ Nice UI, interactive\n\nBACKEND (ASP.NET Core API):\n‚Ä¢ The kitchen\n‚Ä¢ Prepares the food\n‚Ä¢ Database, business logic\n\nHttpClient = The waiter who connects them!\n\nBlazer ‚Üê HttpClient ‚Üí API ‚Üê EF Core ‚Üí Database\n\nBlazor calls API:\n1. User clicks button\n2. Blazor makes HTTP request\n3. API processes (database query)\n4. API sends JSON response\n5. Blazor displays data\n\nThink: HttpClient = 'The bridge between your beautiful UI and powerful backend!'",
  "coderExample": "// API (Backend) - Program.cs\nvar builder = WebApplication.CreateBuilder(args);\nbuilder.Services.AddDbContext<AppDbContext>();\n\nvar app = builder.Build();\n\n// CORS for Blazor\napp.UseCors(policy => policy\n    .AllowAnyOrigin()\n    .AllowAnyMethod()\n    .AllowAnyHeader());\n\napp.MapGet(\"/api/products\", async (AppDbContext db) =>\n    await db.Products.ToListAsync());\n\napp.MapGet(\"/api/products/{id}\", async (int id, AppDbContext db) =>\n    await db.Products.FindAsync(id));\n\napp.Run();\n\n// BLAZOR (Frontend) - Using HttpClient\n@inject HttpClient Http\n\n<h3>Products</h3>\n\n@if (products == null)\n{\n    <p>Loading...</p>\n}\nelse\n{\n    <ul>\n        @foreach (var product in products)\n        {\n            <li>@product.Name - $@product.Price</li>\n        }\n    </ul>\n}\n\n@code {\n    private List<Product>? products;\n    \n    protected override async Task OnInitializedAsync()\n    {\n        // Call API!\n        products = await Http.GetFromJsonAsync<List<Product>>(\n            \"https://localhost:5001/api/products\");\n    }\n}\n\n// POST REQUEST\nprivate async Task CreateProduct(Product product)\n{\n    var response = await Http.PostAsJsonAsync(\n        \"https://localhost:5001/api/products\", product);\n    \n    if (response.IsSuccessStatusCode)\n    {\n        Console.WriteLine(\"Product created!\");\n    }\n}\n\n// PUT REQUEST\nprivate async Task UpdateProduct(int id, Product product)\n{\n    await Http.PutAsJsonAsync(\n        $\"https://localhost:5001/api/products/{id}\", product);\n}\n\n// DELETE REQUEST\nprivate async Task DeleteProduct(int id)\n{\n    await Http.DeleteAsync(\n        $\"https://localhost:5001/api/products/{id}\");\n}\n\n// ERROR HANDLING\ntry\n{\n    products = await Http.GetFromJsonAsync<List<Product>>(\n        \"https://localhost:5001/api/products\");\n}\ncatch (HttpRequestException ex)\n{\n    errorMessage = $\"API Error: {ex.Message}\";\n}",
  "syntaxBreakdown": [
    {
      "codeSnippet": "@inject HttpClient Http",
      "explanation": "Injects HttpClient into component. Use 'Http' to make API calls. Configured in Program.cs with BaseAddress."
    },
    {
      "codeSnippet": "GetFromJsonAsync<T>(url)",
      "explanation": "GET request, deserializes JSON to T. Returns T or null. Throws HttpRequestException on failure. Use try/catch!"
    },
    {
      "codeSnippet": "PostAsJsonAsync(url, data)",
      "explanation": "POST request, serializes data to JSON. Returns HttpResponseMessage. Check response.IsSuccessStatusCode for success."
    },
    {
      "codeSnippet": "CORS configuration",
      "explanation": "API must enable CORS for Blazor WebAssembly! Use UseCors() with AllowAnyOrigin(). Without it, browser blocks requests (CORS error)."
    }
  ],
  "challenge": {
    "instructions": "Build a full-stack Todo app!\n\n1. API (backend):\n   - Todo model (Id, Title, IsCompleted)\n   - GET /api/todos (list all)\n   - POST /api/todos (create)\n   - PUT /api/todos/{id} (update)\n   - DELETE /api/todos/{id} (delete)\n   - Use in-memory list\n\n2. Blazor component (frontend):\n   - Inject HttpClient\n   - OnInitializedAsync: load todos\n   - Display list with checkboxes\n   - Input to add new todo\n   - Delete button for each\n   - Handle loading and errors\n\n3. Print both API and Blazor code!\n\nThis is your first full-stack app!",
    "starterCode": "// API - Program.cs\nvar builder = WebApplication.CreateBuilder(args);\nvar app = builder.Build();\n\nvar todos = new List<Todo> {\n    new Todo { Id = 1, Title = \"Learn Blazor\", IsCompleted = false }\n};\n\napp.MapGet(\"/api/todos\", () => todos);\n\n// Add other endpoints...\n\napp.Run();\n\n// Blazor - TodoList.razor\n@inject HttpClient Http\n\n<h3>Todo List</h3>\n\n@if (todos == null)\n{\n    <p>Loading...</p>\n}\nelse\n{\n    <ul>\n        @foreach (var todo in todos)\n        {\n            <li>\n                <input type=\"checkbox\" @bind=\"todo.IsCompleted\" />\n                @todo.Title\n                <button @onclick=\"() => DeleteTodo(todo.Id)\">Delete</button>\n            </li>\n        }\n    </ul>\n}\n\n@code {\n    private List<Todo>? todos;\n    \n    protected override async Task OnInitializedAsync()\n    {\n        await LoadTodos();\n    }\n    \n    private async Task LoadTodos()\n    {\n        // Call API\n    }\n}",
    "solutionCode": "Console.WriteLine(@\"\n=== API (BACKEND) - Program.cs ===\");\nConsole.WriteLine(@\"\nusing Microsoft.AspNetCore.Builder;\nusing System.Collections.Generic;\nusing System.Linq;\n\nvar builder = WebApplication.CreateBuilder(args);\nvar app = builder.Build();\n\n// Enable CORS for Blazor\napp.UseCors(policy => policy\n    .AllowAnyOrigin()\n    .AllowAnyMethod()\n    .AllowAnyHeader());\n\nclass Todo {\n    public int Id { get; set; }\n    public string Title { get; set; } = \"\"\"\";\n    public bool IsCompleted { get; set; }\n}\n\nvar todos = new List<Todo> {\n    new Todo { Id = 1, Title = \"\"Learn Blazor\"\", IsCompleted = false },\n    new Todo { Id = 2, Title = \"\"Build API\"\", IsCompleted = true }\n};\nint nextId = 3;\n\napp.MapGet(\"\"/api/todos\"\", () => todos);\n\napp.MapGet(\"\"/api/todos/{id}\"\", (int id) => {\n    var todo = todos.FirstOrDefault(t => t.Id == id);\n    return todo is not null ? Results.Ok(todo) : Results.NotFound();\n});\n\napp.MapPost(\"\"/api/todos\"\", (Todo todo) => {\n    todo.Id = nextId++;\n    todos.Add(todo);\n    return Results.Created($\"\"/api/todos/{todo.Id}\"\", todo);\n});\n\napp.MapPut(\"\"/api/todos/{id}\"\", (int id, Todo updated) => {\n    var todo = todos.FirstOrDefault(t => t.Id == id);\n    if (todo is null) return Results.NotFound();\n    \n    todo.Title = updated.Title;\n    todo.IsCompleted = updated.IsCompleted;\n    return Results.Ok(todo);\n});\n\napp.MapDelete(\"\"/api/todos/{id}\"\", (int id) => {\n    var todo = todos.FirstOrDefault(t => t.Id == id);\n    if (todo is null) return Results.NotFound();\n    \n    todos.Remove(todo);\n    return Results.NoContent();\n});\n\napp.Run();\n\"\");\n\nConsole.WriteLine(@\"\n=== BLAZOR (FRONTEND) - TodoList.razor ===\");\nConsole.WriteLine(@\"\n@inject HttpClient Http\n\n<div class=\"\"container\"\">\n    <h3>üìù Full-Stack Todo App</h3>\n    \n    @if (isLoading)\n    {\n        <div class=\"\"spinner-border\"\" role=\"\"status\"\"></div>\n        <span>Loading...</span>\n    }\n    else if (errorMessage != null)\n    {\n        <div class=\"\"alert alert-danger\"\">@errorMessage</div>\n    }\n    else\n    {\n        <div class=\"\"mb-3\"\">\n            <input @bind=\"\"newTodoTitle\"\" class=\"\"form-control\"\" placeholder=\"\"New todo...\"\" />\n            <button class=\"\"btn btn-primary\"\" @onclick=\"\"AddTodo\"\">Add</button>\n        </div>\n        \n        <ul class=\"\"list-group\"\">\n            @foreach (var todo in todos)\n            {\n                <li class=\"\"list-group-item\"\">\n                    <input \n                        type=\"\"checkbox\"\" \n                        checked=\"\"@todo.IsCompleted\"\n                        @onchange=\"\"() => ToggleTodo(todo)\"\" />\n                    <span class=\"\"@(todo.IsCompleted ? \\\"\"text-decoration-line-through\\\"\" : \"\"\"\")\"\">\n                        @todo.Title\n                    </span>\n                    <button \n                        class=\"\"btn btn-sm btn-danger float-end\"\" \n                        @onclick=\"\"() => DeleteTodo(todo.Id)\"\">Delete</button>\n                </li>\n            }\n        </ul>\n    }\n</div>\n\n@code {\n    private class Todo {\n        public int Id { get; set; }\n        public string Title { get; set; } = \"\"\"\";\n        public bool IsCompleted { get; set; }\n    }\n    \n    private List<Todo> todos = new();\n    private string newTodoTitle = \"\"\"\";\n    private bool isLoading = true;\n    private string? errorMessage;\n    \n    protected override async Task OnInitializedAsync()\n    {\n        await LoadTodos();\n    }\n    \n    private async Task LoadTodos()\n    {\n        try\n        {\n            isLoading = true;\n            todos = await Http.GetFromJsonAsync<List<Todo>>(\"\"https://localhost:5001/api/todos\"\") ?? new();\n            errorMessage = null;\n        }\n        catch (HttpRequestException ex)\n        {\n            errorMessage = $\"\"API Error: {ex.Message}\"\";\n        }\n        finally\n        {\n            isLoading = false;\n        }\n    }\n    \n    private async Task AddTodo()\n    {\n        if (string.IsNullOrWhiteSpace(newTodoTitle)) return;\n        \n        var newTodo = new Todo { Title = newTodoTitle, IsCompleted = false };\n        var response = await Http.PostAsJsonAsync(\"\"https://localhost:5001/api/todos\"\", newTodo);\n        \n        if (response.IsSuccessStatusCode)\n        {\n            newTodoTitle = \"\"\"\";\n            await LoadTodos();\n        }\n    }\n    \n    private async Task ToggleTodo(Todo todo)\n    {\n        todo.IsCompleted = !todo.IsCompleted;\n        await Http.PutAsJsonAsync($\"\"https://localhost:5001/api/todos/{todo.Id}\"\", todo);\n    }\n    \n    private async Task DeleteTodo(int id)\n    {\n        var response = await Http.DeleteAsync($\"\"https://localhost:5001/api/todos/{id}\"\");\n        if (response.IsSuccessStatusCode)\n        {\n            await LoadTodos();\n        }\n    }\n}\n\"\");\n\nConsole.WriteLine(@\"\n=== FULL-STACK ARCHITECTURE ===\");\nConsole.WriteLine(\"Frontend (Blazor) ‚Üí HttpClient ‚Üí API ‚Üí Database\");\nConsole.WriteLine(\"‚úì Blazor: UI, user interaction\");\nConsole.WriteLine(\"‚úì HttpClient: Communication layer\");\nConsole.WriteLine(\"‚úì API: Business logic, data access\");\nConsole.WriteLine(\"‚úì Separation of concerns!\");\nConsole.WriteLine(\"\\nYou're now a FULL-STACK developer!\");",
    "hint": "API: MapGet/Post/Put/Delete endpoints. Blazor: @inject HttpClient, GetFromJsonAsync<T>, PostAsJsonAsync, PutAsJsonAsync, DeleteAsync. Handle loading state and errors!",
    "expectedOutputPatterns": ["API", "BACKEND", "Blazor", "FRONTEND", "HttpClient", "FULL-STACK"],
    "validationRules": [],
    "commonStickingPoints": [
      "CORS errors: Blazor WebAssembly needs CORS enabled on API! Use app.UseCors() with AllowAnyOrigin(). Browser console shows 'CORS policy' error if missing.",
      "Base address: Configure HttpClient.BaseAddress in Program.cs! Otherwise, use full URLs in every request. BaseAddress = \"https://localhost:5001/\" lets you use relative URLs.",
      "Null reference: GetFromJsonAsync returns null if API not running! Always check: 'todos = await Http.Get...() ?? new();' or handle null explicitly.",
      "Forgetting await: HttpClient methods are async! Must use 'await'. Forgetting await = code continues before response arrives (race condition!). Always await HTTP calls!"
    ]
  }
}
