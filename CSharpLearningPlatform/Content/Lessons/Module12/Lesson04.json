{
  "moduleId": 12,
  "lessonNumber": 4,
  "lessonId": "M12L04",
  "title": "Code-First Design (Databases from C# Classes)",
  "simplifierConcept": "There are TWO ways to build a database app:\n\nDATABASE-FIRST (old way):\n1. Create database tables in SQL\n2. Generate C# classes from database\n3. Hope they stay in sync!\n\nCODE-FIRST (modern way):\n1. Write C# classes\n2. EF Core generates database from classes!\n3. Classes are source of truth\n\nCode-First is like building a house from blueprints:\n• Blueprint = C# class\n• House = Database table\n• Change blueprint → Rebuild house automatically!\n\nBENEFITS:\n✅ Version control - Classes in Git, database changes tracked!\n✅ Refactoring - Rename property? Database updates!\n✅ Portable - Same classes work with SQL Server, PostgreSQL, etc.\n✅ Testable - Use in-memory database for tests\n\nThink: Code-First = 'Your C# code IS the database schema. Database generated from code!'",
  "coderExample": "using Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\n\n// STEP 1: DEFINE ENTITIES (classes)\nclass Customer\n{\n    public int Id { get; set; }  // Primary key (convention)\n    \n    [Required]  // NOT NULL in database\n    [MaxLength(100)]  // VARCHAR(100)\n    public string Name { get; set; } = string.Empty;\n    \n    [Required]\n    [EmailAddress]  // Validation attribute\n    public string Email { get; set; } = string.Empty;\n    \n    public int Age { get; set; }\n    \n    // Navigation property - RELATIONSHIP!\n    public List<Order> Orders { get; set; } = new();\n}\n\nclass Order\n{\n    public int Id { get; set; }\n    \n    public int CustomerId { get; set; }  // Foreign key\n    \n    [Column(TypeName = \"decimal(18,2)\")]  // Precision for money\n    public decimal Total { get; set; }\n    \n    public DateTime OrderDate { get; set; }\n    \n    // Navigation property\n    public Customer Customer { get; set; } = null!;\n}\n\n// STEP 2: DBCONTEXT\nclass StoreDbContext : DbContext\n{\n    public DbSet<Customer> Customers { get; set; }\n    public DbSet<Order> Orders { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        optionsBuilder.UseSqlite(\"Data Source=store.db\");\n    }\n    \n    // STEP 3: Configure relationships (Fluent API)\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        // Configure Customer\n        modelBuilder.Entity<Customer>()\n            .HasKey(c => c.Id);\n        \n        modelBuilder.Entity<Customer>()\n            .HasMany(c => c.Orders)  // Customer has many Orders\n            .WithOne(o => o.Customer)  // Each Order has one Customer\n            .HasForeignKey(o => o.CustomerId);\n        \n        // Seed data (initial data)\n        modelBuilder.Entity<Customer>().HasData(\n            new Customer { Id = 1, Name = \"John Doe\", Email = \"john@example.com\", Age = 30 }\n        );\n    }\n}\n\n// STEP 4: CREATE DATABASE\nusing (var context = new StoreDbContext())\n{\n    context.Database.EnsureDeleted();  // Delete if exists (learning only!)\n    context.Database.EnsureCreated();  // Create from classes!\n    \n    Console.WriteLine(\"Database created from C# classes!\");\n    Console.WriteLine(\"Tables: Customers, Orders\");\n    Console.WriteLine(\"Relationship: Customer 1-to-Many Orders\");\n}",
  "syntaxBreakdown": [
    {
      "codeSnippet": "Data Annotations",
      "explanation": "[Required], [MaxLength], [Column], [Key] - Attributes on properties configure database! [Required] = NOT NULL. [MaxLength(50)] = VARCHAR(50)."
    },
    {
      "codeSnippet": "Navigation properties",
      "explanation": "public List<Order> Orders - Represents relationship! Customer has many Orders. EF creates foreign key automatically."
    },
    {
      "codeSnippet": "OnModelCreating()",
      "explanation": "Fluent API configuration. More powerful than attributes! Configure relationships, indexes, constraints. Override in DbContext."
    },
    {
      "codeSnippet": "HasMany().WithOne()",
      "explanation": "Fluent API for 1-to-Many relationship. HasMany(c => c.Orders) on Customer. WithOne(o => o.Customer) on Order. Defines both sides!"
    }
  ],
  "challenge": {
    "instructions": "Build a Blog database with Code-First!\n\n1. Create 'BlogPost' entity:\n   - int Id\n   - string Title ([Required], [MaxLength(200)])\n   - string Content ([Required])\n   - DateTime PublishedDate\n   - int AuthorId (foreign key)\n   - Author Author (navigation property)\n\n2. Create 'Author' entity:\n   - int Id\n   - string Name ([Required], [MaxLength(100)])\n   - string Email ([Required])\n   - List<BlogPost> BlogPosts (navigation property)\n\n3. Create 'BlogDbContext':\n   - DbSet<BlogPost> BlogPosts\n   - DbSet<Author> Authors\n   - Configure relationship in OnModelCreating:\n     - Author has many BlogPosts\n     - BlogPost has one Author\n   - Seed one author\n\n4. Print the schema that would be created:\n   - Table names\n   - Column names and types\n   - Relationships\n\nThis shows Code-First design!",
    "starterCode": "using Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.ComponentModel.DataAnnotations.Schema;\n\nclass BlogPost\n{\n    public int Id { get; set; }\n    \n    [Required]\n    [MaxLength(200)]\n    public string Title { get; set; } = string.Empty;\n    \n    [Required]\n    public string Content { get; set; } = string.Empty;\n    \n    public DateTime PublishedDate { get; set; }\n    \n    public int AuthorId { get; set; }\n    public Author Author { get; set; } = null!;\n}\n\nclass Author\n{\n    public int Id { get; set; }\n    \n    [Required]\n    [MaxLength(100)]\n    public string Name { get; set; } = string.Empty;\n    \n    [Required]\n    public string Email { get; set; } = string.Empty;\n    \n    public List<BlogPost> BlogPosts { get; set; } = new();\n}\n\nclass BlogDbContext : DbContext\n{\n    public DbSet<BlogPost> BlogPosts { get; set; }\n    public DbSet<Author> Authors { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        optionsBuilder.UseSqlite(\"Data Source=blog.db\");\n    }\n    \n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        // Configure relationship\n        modelBuilder.Entity<Author>()\n            .HasMany(a => a.BlogPosts)\n            .WithOne(b => b.Author)\n            .HasForeignKey(b => b.AuthorId);\n        \n        // Seed data\n        modelBuilder.Entity<Author>().HasData(\n            new Author { Id = 1, Name = \"Jane Smith\", Email = \"jane@example.com\" }\n        );\n    }\n}\n\nConsole.WriteLine(\"=== CODE-FIRST DATABASE SCHEMA ===\");\nConsole.WriteLine(\"\\nTable: Authors\");\nConsole.WriteLine(\"  - Id (INT, PRIMARY KEY)\");\nConsole.WriteLine(\"  - Name (VARCHAR(100), NOT NULL)\");\nConsole.WriteLine(\"  - Email (VARCHAR, NOT NULL)\");\n\nConsole.WriteLine(\"\\nTable: BlogPosts\");\nConsole.WriteLine(\"  - Id (INT, PRIMARY KEY)\");\nConsole.WriteLine(\"  - Title (VARCHAR(200), NOT NULL)\");\nConsole.WriteLine(\"  - Content (TEXT, NOT NULL)\");\nConsole.WriteLine(\"  - PublishedDate (DATETIME)\");\nConsole.WriteLine(\"  - AuthorId (INT, FOREIGN KEY → Authors.Id)\");\n\nConsole.WriteLine(\"\\nRelationship:\");\nConsole.WriteLine(\"  Author 1-to-Many BlogPosts\");",
    "solutionCode": "using Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel.DataAnnotations;\nusing System.ComponentModel.DataAnnotations.Schema;\n\nclass BlogPost\n{\n    public int Id { get; set; }\n    \n    [Required]\n    [MaxLength(200)]\n    public string Title { get; set; } = string.Empty;\n    \n    [Required]\n    public string Content { get; set; } = string.Empty;\n    \n    public DateTime PublishedDate { get; set; }\n    \n    public int AuthorId { get; set; }\n    public Author Author { get; set; } = null!;\n}\n\nclass Author\n{\n    public int Id { get; set; }\n    \n    [Required]\n    [MaxLength(100)]\n    public string Name { get; set; } = string.Empty;\n    \n    [Required]\n    public string Email { get; set; } = string.Empty;\n    \n    public List<BlogPost> BlogPosts { get; set; } = new();\n}\n\nclass BlogDbContext : DbContext\n{\n    public DbSet<BlogPost> BlogPosts { get; set; }\n    public DbSet<Author> Authors { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        optionsBuilder.UseSqlite(\"Data Source=blog.db\");\n    }\n    \n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        modelBuilder.Entity<Author>()\n            .HasMany(a => a.BlogPosts)\n            .WithOne(b => b.Author)\n            .HasForeignKey(b => b.AuthorId);\n        \n        modelBuilder.Entity<Author>().HasData(\n            new Author { Id = 1, Name = \"Jane Smith\", Email = \"jane@example.com\" }\n        );\n    }\n}\n\nConsole.WriteLine(\"=== CODE-FIRST DATABASE SCHEMA ===\");\nConsole.WriteLine(\"Database generated from C# classes!\\n\");\n\nConsole.WriteLine(\"Table: Authors\");\nConsole.WriteLine(\"  Columns:\");\nConsole.WriteLine(\"    - Id (INT, PRIMARY KEY, AUTO-INCREMENT)\");\nConsole.WriteLine(\"    - Name (VARCHAR(100), NOT NULL)\");\nConsole.WriteLine(\"    - Email (VARCHAR, NOT NULL)\");\n\nConsole.WriteLine(\"\\nTable: BlogPosts\");\nConsole.WriteLine(\"  Columns:\");\nConsole.WriteLine(\"    - Id (INT, PRIMARY KEY, AUTO-INCREMENT)\");\nConsole.WriteLine(\"    - Title (VARCHAR(200), NOT NULL)\");\nConsole.WriteLine(\"    - Content (TEXT, NOT NULL)\");\nConsole.WriteLine(\"    - PublishedDate (DATETIME)\");\nConsole.WriteLine(\"    - AuthorId (INT, FOREIGN KEY → Authors.Id)\");\n\nConsole.WriteLine(\"\\nRelationships:\");\nConsole.WriteLine(\"  ✓ Author HAS MANY BlogPosts (1-to-Many)\");\nConsole.WriteLine(\"  ✓ BlogPost BELONGS TO one Author\");\n\nConsole.WriteLine(\"\\nSeed Data:\");\nConsole.WriteLine(\"  ✓ Author: Jane Smith (jane@example.com)\");\n\nConsole.WriteLine(\"\\n=== BENEFITS OF CODE-FIRST ===\");\nConsole.WriteLine(\"✅ C# classes = Source of truth\");\nConsole.WriteLine(\"✅ Database auto-generated from classes\");\nConsole.WriteLine(\"✅ Refactor code → Database updates via migrations\");\nConsole.WriteLine(\"✅ Version control friendly (classes in Git!)\");",
    "hint": "Attributes: [Required], [MaxLength(n)]. Navigation: List<T> for many, single property for one. OnModelCreating: HasMany().WithOne().HasForeignKey(). HasData() seeds initial data.",
    "expectedOutputPatterns": ["CODE-FIRST", "Authors", "BlogPosts", "Relationship", "BENEFITS"],
    "validationRules": [],
    "commonStickingPoints": [
      "Missing null-forgiving operator: Navigation properties like 'public Author Author' need '= null!' in modern C#. Otherwise nullable warnings. Or make nullable: 'Author?'.",
      "Forgetting inverse navigation: Define BOTH sides of relationship! Customer has List<Order>, Order has Customer. EF uses both to create proper foreign key.",
      "Attributes vs Fluent API: Simple configs = attributes. Complex = Fluent API. Can mix both! Fluent API overrides attributes if both used.",
      "EnsureCreated limitations: Can't modify schema after creation! Use Migrations in real apps. EnsureCreated() is learning/testing only. No schema updates possible!"
    ]
  }
}
