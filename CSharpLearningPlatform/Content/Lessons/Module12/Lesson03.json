{
  "moduleId": 12,
  "lessonNumber": 3,
  "lessonId": "M12L03",
  "title": "Entity Framework Core 8 Basics",
  "simplifierConcept": "Entity Framework Core 8 is the LATEST ORM from Microsoft (released with .NET 8):\n\nThink of it as a SMART ASSISTANT for database work:\n\nYou: 'I need all customers from New York'\nEF Core: Generates SQL, executes it, returns C# objects\n\nYou: 'Save this new customer'\nEF Core: Generates INSERT statement, handles it\n\nYou: 'This customer's email changed'\nEF Core: Tracks the change, generates UPDATE on SaveChanges()\n\nNEW IN EF CORE 8 (.NET 8 features):\n• Complex types (value objects)\n• Bulk operations (ExecuteDelete/ExecuteUpdate)\n• JSON columns (store JSON in database)\n• Better performance\n• Primitive collections support\n\nSETUP:\n1. Install packages (Microsoft.EntityFrameworkCore, provider like .Sqlite)\n2. Create entity classes\n3. Create DbContext class\n4. Configure connection\n5. Create database with migrations\n\nThink: EF Core 8 = 'Modern, fast, feature-rich bridge between C# and databases!'",
  "coderExample": "// ENTITY FRAMEWORK CORE 8 SETUP\n\n// 1. INSTALL PACKAGES (via NuGet or dotnet CLI):\n// dotnet add package Microsoft.EntityFrameworkCore.Sqlite\n// dotnet add package Microsoft.EntityFrameworkCore.Design\n\nusing Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\n// 2. DEFINE ENTITIES\nclass Product\n{\n    public int Id { get; set; }  // Primary Key (by convention)\n    public string Name { get; set; } = string.Empty;\n    public decimal Price { get; set; }\n    public int Stock { get; set; }\n}\n\n// 3. CREATE DBCONTEXT\nclass AppDbContext : DbContext\n{\n    // DbSet = table in database\n    public DbSet<Product> Products { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        // SQLite database (file-based, great for learning!)\n        optionsBuilder.UseSqlite(\"Data Source=app.db\");\n    }\n}\n\n// 4. USING EF CORE\nusing (var context = new AppDbContext())\n{\n    // ENSURE DATABASE EXISTS\n    context.Database.EnsureCreated();\n    \n    // CREATE (INSERT)\n    var product = new Product \n    { \n        Name = \"Laptop\", \n        Price = 999.99m, \n        Stock = 10 \n    };\n    context.Products.Add(product);\n    context.SaveChanges();  // Executes SQL INSERT\n    \n    Console.WriteLine(\"Product added with ID: \" + product.Id);\n    \n    // READ (SELECT)\n    var allProducts = context.Products.ToList();\n    var expensiveProducts = context.Products\n        .Where(p => p.Price > 500)\n        .ToList();\n    \n    // UPDATE\n    var productToUpdate = context.Products.First();\n    productToUpdate.Price = 899.99m;\n    context.SaveChanges();  // Executes SQL UPDATE\n    \n    // DELETE\n    var productToDelete = context.Products.Find(1);  // Find by primary key\n    if (productToDelete != null)\n    {\n        context.Products.Remove(productToDelete);\n        context.SaveChanges();  // Executes SQL DELETE\n    }\n}",
  "syntaxBreakdown": [
    {
      "codeSnippet": "DbContext : DbContext",
      "explanation": "Your DbContext inherits from EF's DbContext. Represents a session with database. Contains DbSet<T> properties for tables."
    },
    {
      "codeSnippet": "DbSet<T>",
      "explanation": "Represents a table. DbSet<Product> Products = Products table. Use LINQ on DbSet to query. Add/Remove to modify."
    },
    {
      "codeSnippet": "OnConfiguring()",
      "explanation": "Configure database provider and connection string. UseSqlite(), UseSqlServer(), UseNpgsql() (PostgreSQL). Override in your DbContext."
    },
    {
      "codeSnippet": "SaveChanges()",
      "explanation": "Persists ALL tracked changes to database! Add, modify, remove objects, then call SaveChanges() ONCE. Batches SQL statements efficiently."
    }
  ],
  "challenge": {
    "instructions": "Create your first Entity Framework Core application!\n\n1. Define a 'Student' entity:\n   - int Id (primary key)\n   - string Name\n   - int Age\n   - string Major\n\n2. Create 'SchoolDbContext' inheriting DbContext:\n   - DbSet<Student> Students property\n   - OnConfiguring: use SQLite (\\\"Data Source=school.db\\\")\n\n3. Simulate EF Core operations (print SQL commands that would execute):\n   - Create context\n   - Add 3 students\n   - Print: \\\"SQL: INSERT INTO Students...\\\"\n   - Query students over age 20\n   - Print: \\\"SQL: SELECT * FROM Students WHERE Age > 20\\\"\n   - Update first student's major\n   - Print: \\\"SQL: UPDATE Students SET Major = ...\\\"\n   - Delete a student\n   - Print: \\\"SQL: DELETE FROM Students WHERE Id = ...\\\"\n\nThis shows EF Core's CRUD operations!",
    "starterCode": "using Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nclass Student\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n    public int Age { get; set; }\n    public string Major { get; set; }\n}\n\nclass SchoolDbContext : DbContext\n{\n    public DbSet<Student> Students { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        optionsBuilder.UseSqlite(\"Data Source=school.db\");\n    }\n}\n\nConsole.WriteLine(\"=== ENTITY FRAMEWORK CORE SIMULATION ===\");\n\n// Simulate CREATE\nConsole.WriteLine(\"\\n[CREATE] Adding students...\");\nvar student1 = new Student { Name = \"Alice\", Age = 22, Major = \"Computer Science\" };\nvar student2 = new Student { Name = \"Bob\", Age = 19, Major = \"Mathematics\" };\nvar student3 = new Student { Name = \"Charlie\", Age = 23, Major = \"Physics\" };\n\nConsole.WriteLine(\"SQL: INSERT INTO Students (Name, Age, Major) VALUES ('Alice', 22, 'Computer Science')\");\nConsole.WriteLine(\"SQL: INSERT INTO Students (Name, Age, Major) VALUES ('Bob', 19, 'Mathematics')\");\nConsole.WriteLine(\"SQL: INSERT INTO Students (Name, Age, Major) VALUES ('Charlie', 23, 'Physics')\");\nConsole.WriteLine(\"3 students added!\");\n\n// Simulate READ\nConsole.WriteLine(\"\\n[READ] Querying students over age 20...\");\nConsole.WriteLine(\"SQL: SELECT * FROM Students WHERE Age > 20\");\nConsole.WriteLine(\"Found: Alice (22), Charlie (23)\");\n\n// Simulate UPDATE\nConsole.WriteLine(\"\\n[UPDATE] Changing Alice's major...\");\nConsole.WriteLine(\"SQL: UPDATE Students SET Major = 'Data Science' WHERE Id = 1\");\nConsole.WriteLine(\"Updated!\");\n\n// Simulate DELETE\nConsole.WriteLine(\"\\n[DELETE] Removing student with ID 2...\");\nConsole.WriteLine(\"SQL: DELETE FROM Students WHERE Id = 2\");\nConsole.WriteLine(\"Deleted!\");",
    "solutionCode": "using Microsoft.EntityFrameworkCore;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nclass Student\n{\n    public int Id { get; set; }\n    public string Name { get; set; } = string.Empty;\n    public int Age { get; set; }\n    public string Major { get; set; } = string.Empty;\n}\n\nclass SchoolDbContext : DbContext\n{\n    public DbSet<Student> Students { get; set; }\n    \n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        optionsBuilder.UseSqlite(\"Data Source=school.db\");\n    }\n}\n\nConsole.WriteLine(\"=== ENTITY FRAMEWORK CORE 8 SIMULATION ===\");\nConsole.WriteLine(\"Demonstrating CRUD operations with EF Core\\n\");\n\nConsole.WriteLine(\"[CREATE] Adding students...\");\nvar student1 = new Student { Id = 1, Name = \"Alice\", Age = 22, Major = \"Computer Science\" };\nvar student2 = new Student { Id = 2, Name = \"Bob\", Age = 19, Major = \"Mathematics\" };\nvar student3 = new Student { Id = 3, Name = \"Charlie\", Age = 23, Major = \"Physics\" };\n\nConsole.WriteLine(\"  context.Students.Add(student1);\");\nConsole.WriteLine(\"  context.Students.Add(student2);\");\nConsole.WriteLine(\"  context.Students.Add(student3);\");\nConsole.WriteLine(\"  context.SaveChanges();\");\nConsole.WriteLine(\"\\n  Generated SQL:\");\nConsole.WriteLine(\"    INSERT INTO Students (Name, Age, Major) VALUES ('Alice', 22, 'Computer Science')\");\nConsole.WriteLine(\"    INSERT INTO Students (Name, Age, Major) VALUES ('Bob', 19, 'Mathematics')\");\nConsole.WriteLine(\"    INSERT INTO Students (Name, Age, Major) VALUES ('Charlie', 23, 'Physics')\");\nConsole.WriteLine(\"  ✓ 3 students added!\\n\");\n\nConsole.WriteLine(\"[READ] Querying students over age 20...\");\nConsole.WriteLine(\"  var adults = context.Students.Where(s => s.Age > 20).ToList();\");\nConsole.WriteLine(\"\\n  Generated SQL:\");\nConsole.WriteLine(\"    SELECT * FROM Students WHERE Age > 20\");\nConsole.WriteLine(\"  ✓ Found: Alice (22), Charlie (23)\\n\");\n\nConsole.WriteLine(\"[UPDATE] Changing Alice's major...\");\nConsole.WriteLine(\"  var alice = context.Students.Find(1);\");\nConsole.WriteLine(\"  alice.Major = 'Data Science';\");\nConsole.WriteLine(\"  context.SaveChanges();\");\nConsole.WriteLine(\"\\n  Generated SQL:\");\nConsole.WriteLine(\"    UPDATE Students SET Major = 'Data Science' WHERE Id = 1\");\nConsole.WriteLine(\"  ✓ Updated!\\n\");\n\nConsole.WriteLine(\"[DELETE] Removing student with ID 2...\");\nConsole.WriteLine(\"  var bob = context.Students.Find(2);\");\nConsole.WriteLine(\"  context.Students.Remove(bob);\");\nConsole.WriteLine(\"  context.SaveChanges();\");\nConsole.WriteLine(\"\\n  Generated SQL:\");\nConsole.WriteLine(\"    DELETE FROM Students WHERE Id = 2\");\nConsole.WriteLine(\"  ✓ Deleted!\\n\");\n\nConsole.WriteLine(\"=== EF CORE TRACKS CHANGES AUTOMATICALLY ===\");\nConsole.WriteLine(\"You modify objects in C# → EF Core generates SQL → Database updated!\");",
    "hint": "DbContext: inherit from DbContext. DbSet<T>: represents table. OnConfiguring: setup connection. CRUD: Add(), Where(), modify object, Remove(). SaveChanges() executes SQL!",
    "expectedOutputPatterns": ["ENTITY FRAMEWORK", "CREATE", "READ", "UPDATE", "DELETE", "SQL"],
    "validationRules": [],
    "commonStickingPoints": [
      "Forgetting SaveChanges(): Add/Remove/modify objects doesn't touch database! Must call context.SaveChanges() to persist. No SaveChanges() = no database changes!",
      "Not disposing context: DbContext implements IDisposable! Always use 'using' statement or call Dispose(). Otherwise connection leaks!",
      "Id property confusion: By convention, 'Id' or '[ClassName]Id' is primary key. EF auto-increments it on Insert. Don't set Id yourself when inserting!",
      "EnsureCreated vs Migrations: EnsureCreated() creates DB but CAN'T update schema! Use Migrations in real apps. EnsureCreated() is only for learning/testing!"
    ]
  }
}
